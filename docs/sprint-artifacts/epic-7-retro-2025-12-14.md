# Epic 7 Retrospective - Recommendations

**Date:** 2025-12-14
**Epic:** Epic 7 - Recommendations
**Facilitator:** Bob (Scrum Master Agent)
**Attendees:** Alice (PO), Bob (SM), Charlie (Senior Dev), Dana (QA), Elena (Junior Dev), Bmad (Project Lead)

---

## Epic Summary

| Metric            | Value                                   |
| ----------------- | --------------------------------------- |
| Stories Completed | 10/10 (100%)                            |
| Test Coverage     | ~2785 tests at epic end                 |
| Code Reviews      | All APPROVED                            |
| Build Status      | Passing (with pre-existing Clerk issue) |

**Business Outcome Delivered:**

- Core product value: "What should I buy this month?"
- User can enter monthly contribution + dividends
- System generates prioritized investment recommendations
- User can confirm investments and see updated allocations
- Full audit trail via event sourcing (ADR-002)

---

## Stories Completed

| Story | Title                                | Status |
| ----- | ------------------------------------ | ------ |
| 7.1   | Enter Monthly Contribution           | done   |
| 7.2   | Enter Dividends Received             | done   |
| 7.3   | Calculate Total Investable Capital   | done   |
| 7.4   | Generate Investment Recommendations  | done   |
| 7.5   | Display Recommendations (Focus Mode) | done   |
| 7.6   | Zero Buy Signal for Over-Allocated   | done   |
| 7.7   | View Recommendation Breakdown        | done   |
| 7.8   | Confirm Recommendations              | done   |
| 7.9   | Update Portfolio After Confirmation  | done   |
| 7.10  | View Updated Allocation              | done   |

---

## What Went Well

### Product & Delivery

1. **Story sequencing excellence** - Each story built naturally on the previous. Dev Agent Records created a knowledge chain that prevented re-work.
2. **Core value delivered** - Users can now answer "What should I buy?" - the heart of this product.
3. **No scope creep** - Stayed focused on MVP requirements. TODO markers used appropriately for future work.

### Technical

1. **Decimal.js precision maintained throughout** - Zero floating-point bugs. Pattern from early epics paid dividends.
2. **Event sourcing implementation** - ADR-002 followed consistently. Every calculation has correlation ID for audit trail.
3. **Story 7.9 overlap detection** - When Story 7.8 already implemented most of 7.9's requirements, pivoted to validation and testing instead of duplicate work.

### Quality

1. **Interface/utility testing pattern** - Despite @testing-library/react constraints, achieved comprehensive coverage via testing utilities and exported functions.
2. **Code review APPROVED all stories** - Zero rejections, zero false task completions detected.
3. **Test count growth** - From ~2400 to ~2785 tests. Each story added meaningful coverage.

### Learning & Knowledge Transfer

1. **Dev Agent Records are gold** - "Learnings from Previous Story" sections saved hours of re-discovery.
2. **TypeScript exactOptionalPropertyTypes pattern** - Once documented, `| undefined` fix became automatic.
3. **Cache-first architecture** - Recommendation retrieval pattern is clean and performant.

---

## What Didn't Go Well

### Technical Debt

1. **@clerk/nextjs dependency issue persists** - Blocked builds at various points. Pre-existing but never fixed. Story 7.9's Task 10 noted "Build verification blocked by missing @clerk/nextjs dependency."
2. **React Query not installed** - Adapted with native fetch, which works, but every hook reinvents caching logic.
3. **TypeScript exactOptionalPropertyTypes surprises** - Hit this in almost every story. Should have documented in CLAUDE.md earlier.

### Testing Gaps

1. **No @testing-library/react** - Worked around it, but some components have no rendering tests. Relying on future E2E tests that don't exist yet.
2. **Visual verification deferred** - Story 7.5 noted "Visual verification in browser deferred - no dev server running." Multiple stories skipped browser testing.
3. **E2E test coverage unknown** - Referenced Playwright E2E tests as fallback, but coverage for Epic 7 features unclear.

### Process

1. **Epic 6 blockers status unknown** - Committed to 2 HARD BLOCKERS before Epic 7: console.error cleanup and ESLint upgrade to "error". No clear evidence these were completed.
2. **TODO markers accumulating** - `TODO(epic-8)` for base currency, market price integration... no central tracking.

### Knowledge Management

1. **Pattern discovery repeated** - The `| undefined` fix appeared as a "discovery" in multiple stories instead of being documented once.
2. **Cache invalidation timing** - Story 7.9 had to fix cache invalidation from single-key to multi-key. Should have been caught in Story 7.8's design.

---

## Previous Retrospective Follow-Up (Epic 6)

| Action Item                          | Commitment   | Status                                |
| ------------------------------------ | ------------ | ------------------------------------- |
| Console.error cleanup (20+ files)    | HARD BLOCKER | :warning: NEEDS VERIFICATION          |
| Upgrade ESLint no-console to "error" | HARD BLOCKER | :warning: NEEDS VERIFICATION          |
| Pre-commit hook                      | CRITICAL     | :white_check_mark: Completed (Epic 5) |
| Integrate DataFreshnessBadge         | MUST DO      | :question: UNKNOWN                    |
| Integrate SourceAttribution          | MUST DO      | :question: UNKNOWN                    |
| Add test mock validation checklist   | PROCESS      | :question: UNKNOWN                    |

**Note:** Epic 6 retrospective committed to resolving console.error and ESLint blockers BEFORE Epic 7 could start. Verification needed.

---

## Action Items for Epic 8

### HARD BLOCKERS (Must resolve before Epic 8)

| #   | Action Item                                          | Owner    | Commitment            |
| --- | ---------------------------------------------------- | -------- | --------------------- |
| 1   | Resolve @clerk/nextjs dependency - install or remove | Dev Team | Before Epic 8 Story 1 |
| 2   | Verify Epic 6 console.error cleanup completed        | Dev Team | Before Epic 8         |
| 3   | Verify ESLint no-console set to "error"              | Dev Team | Before Epic 8         |

### CRITICAL (Should resolve during Epic 8)

| #   | Action Item                                                 | Owner    | Commitment         |
| --- | ----------------------------------------------------------- | -------- | ------------------ |
| 4   | Document exactOptionalPropertyTypes pattern in CLAUDE.md    | Dev Team | Sprint 1 of Epic 8 |
| 5   | Grep TODO markers at Epic 8 start, create stories as needed | SM Agent | Epic 8 kickoff     |

### SHOULD DO (Process Improvements)

| #   | Action Item                                                                       | Owner    | Commitment                |
| --- | --------------------------------------------------------------------------------- | -------- | ------------------------- |
| 6   | Create E2E tests for recommendation flow (generate -> confirm -> view allocation) | QA/Dev   | Epic 8 or dedicated story |
| 7   | Evaluate React Query installation (tech spike)                                    | Dev Team | Backlog - low priority    |

### PROCESS IMPROVEMENTS

| #   | Action Item                                                                        | Owner    | Commitment |
| --- | ---------------------------------------------------------------------------------- | -------- | ---------- |
| 8   | Update story template: verification must note any pre-existing blockers explicitly | SM Agent | Immediate  |

---

## Commitment Summary Matrix

| Priority                  | Action Item                                      | Status Gate          |
| ------------------------- | ------------------------------------------------ | -------------------- |
| :red_circle: HARD BLOCKER | Resolve @clerk/nextjs dependency                 | Before Epic 8 starts |
| :red_circle: HARD BLOCKER | Verify Epic 6 console.error cleanup              | Before Epic 8 starts |
| :red_circle: HARD BLOCKER | Verify ESLint no-console = "error"               | Before Epic 8 starts |
| :orange_circle: CRITICAL  | Document exactOptionalPropertyTypes in CLAUDE.md | Sprint 1             |
| :orange_circle: CRITICAL  | Grep and track TODO markers                      | Epic 8 kickoff       |
| :yellow_circle: SHOULD DO | E2E tests for recommendation flow                | During Epic 8        |
| :green_circle: BACKLOG    | Evaluate React Query                             | Low priority         |

---

## Next Epic Preview

**Epic 8: Overnight Processing**

- Status: `backlog` (not yet contexted)
- Stories: 6 planned
- Goal: Pre-compute everything overnight for instant dashboard load

**Key Stories:**

- 8.1: Inngest Job Infrastructure
- 8.2: Overnight Scoring Job
- 8.3: Recommendation Pre-generation
- 8.4: Cache Warming
- 8.5: Instant Dashboard Load
- 8.6: Calculation Audit Trail

**Dependencies on Epic 7:**

- Recommendation engine (from 7.4)
- Investment confirmation flow (from 7.8-7.9)
- Cache infrastructure patterns established

---

## Team Sign-Off

| Role          | Name    | Approved           |
| ------------- | ------- | ------------------ |
| Product Owner | Alice   | :white_check_mark: |
| Scrum Master  | Bob     | :white_check_mark: |
| Senior Dev    | Charlie | :white_check_mark: |
| QA Engineer   | Dana    | :white_check_mark: |
| Junior Dev    | Elena   | :white_check_mark: |
| Project Lead  | Bmad    | :white_check_mark: |

---

## Retrospective Metadata

- **Workflow:** BMM Retrospective v1.0
- **Agent Model:** Claude Opus 4.5 (claude-opus-4-5-20251101)
- **Generated:** 2025-12-14
- **Previous Retro:** [Epic 6 Retrospective](epic-6-retro-2025-12-11.md)
